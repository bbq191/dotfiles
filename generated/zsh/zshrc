#!/bin/zsh
# ç”± dotfiles ç”Ÿæˆå™¨ç”Ÿæˆçš„ ZSH é…ç½®

# åŸºç¡€ç¯å¢ƒå˜é‡

export EDITOR="code-insiders"

export BROWSER="brave"

export LANG="zh_CN.UTF-8"

export XDG_CONFIG_HOME="${HOME}/AppData/Local"


# ç°ä»£å·¥å…·åˆ«å

if command -v eza > /dev/null; then
    
    alias ls='eza --color=auto --group-directories-first'
    
    alias ll='eza -l --color=auto --group-directories-first'
    
    alias la='eza -la --color=auto --group-directories-first'
    
    alias lt='eza --tree --color=auto'
    
fi

if command -v bat > /dev/null; then
    
    alias cat='bat'
    
    alias catn='bat --style=plain'
    
fi

if command -v rg > /dev/null; then
    
    alias grep='rg'
    
fi

if command -v fd > /dev/null; then
    
    alias find='fd'
    
fi

if command -v dust > /dev/null; then
    
    alias du='dust'
    
fi

if command -v duf > /dev/null; then
    
    alias df='duf'
    
fi

if command -v procs > /dev/null; then
    
    alias ps='procs'
    
fi

if command -v htop > /dev/null; then
    
    alias top='htop'
    
fi

if command -v zoxide > /dev/null; then
    
    alias cd='z'
    
fi


# é«˜çº§å‡½æ•°

# åˆ›å»ºç›®å½•å¹¶è¿›å…¥
mkcd() { mkdir -p "$1" && cd "$1"; }


# æ™ºèƒ½æå–å„ç§å‹ç¼©æ ¼å¼
extract() {
    if [ -f "$1" ]; then
        case "$1" in
            *.tar.bz2)   tar xjf "$1"     ;;
            *.tar.gz)    tar xzf "$1"     ;;
            *.bz2)       bunzip2 "$1"     ;;
            *.rar)       unrar x "$1"     ;;
            *.gz)        gunzip "$1"      ;;
            *.tar)       tar xf "$1"      ;;
            *.tbz2)      tar xjf "$1"     ;;
            *.tgz)       tar xzf "$1"     ;;
            *.zip)       unzip "$1"       ;;
            *.Z)         uncompress "$1"  ;;
            *.7z)        7z x "$1"        ;;
            *.xz)        unxz "$1"        ;;
            *.lzma)      unlzma "$1"      ;;
            *)           echo "'$1' æ— æ³•è¢« extract() æå–" ;;
        esac
    else
        echo "'$1' ä¸æ˜¯æœ‰æ•ˆæ–‡ä»¶"
    fi
}


# æ€æ­»å ç”¨æŒ‡å®šç«¯å£çš„è¿›ç¨‹
killport() {
    if [ -z "$1" ]; then
        echo "ç”¨æ³•: killport <ç«¯å£å·>"
        return 1
    fi
    lsof -ti:$1 | xargs kill -9
}


# å¿«é€Ÿå¯åŠ¨ HTTP æœåŠ¡å™¨
serve() {
    local port=${1:-8000}
    if command -v python > /dev/null; then
        python -m http.server "$port"
    elif command -v python3 > /dev/null; then
        python3 -m http.server "$port"
    else
        echo "éœ€è¦å®‰è£… Python"
    fi
}


# è·å–å¤©æ°”ä¿¡æ¯
weather() {
    local location=${1:-"Beijing"}
    curl -s "wttr.in/$location?lang=zh"
}


# è·å–å…¬ç½‘ IP åœ°å€
myip() {
    curl -s ipinfo.io/ip
}


# æ˜¾ç¤ºç«¯å£ä½¿ç”¨æƒ…å†µ
ports() {
    netstat -tulanp
}


# æ˜¾ç¤ºå†…å­˜å ç”¨æœ€é«˜çš„è¿›ç¨‹
psmem() {
    ps aux | sort -nr -k 4 | head -10
}


# æ˜¾ç¤º CPU å ç”¨æœ€é«˜çš„è¿›ç¨‹
pscpu() {
    ps aux | sort -nr -k 3 | head -10
}


# å¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶
findfile() {
    if command -v fd > /dev/null; then
        fd -t f "$1"
    else
        find . -name "*$1*" -type f 2>/dev/null
    fi
}


# å¿«é€ŸæŸ¥æ‰¾ç›®å½•
finddir() {
    if command -v fd > /dev/null; then
        fd -t d "$1"
    else
        find . -name "*$1*" -type d 2>/dev/null
    fi
}


# å¤‡ä»½æ–‡ä»¶
backup() {
    cp "$1" "$1.bak.$(date +%Y%m%d_%H%M%S)"
}


# æ¸…ç†å·²åˆå¹¶çš„ Git åˆ†æ”¯
gitclean() {
    git branch --merged | grep -v '\*\|main\|master\|develop' | xargs -n 1 git branch -d
}


# é‡æ–°åŠ è½½ shell é…ç½®
reload() {
    source ~/.zshrc && echo "Zsh é…ç½®å·²é‡æ–°åŠ è½½"
}


# æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
sysinfo() {
    echo "=== ç³»ç»Ÿä¿¡æ¯ ==="
    uname -a
    echo ""
    echo "=== å†…å­˜ä½¿ç”¨ ==="
    free -h
    echo ""
    echo "=== ç£ç›˜ä½¿ç”¨ ==="
    df -h
}



# å¤–éƒ¨å·¥å…·åˆå§‹åŒ–

command -v thefuck > /dev/null && eval "$(thefuck --alias)"

command -v gh_copilot > /dev/null && eval "$(gh copilot alias -- zsh)"

command -v fnm > /dev/null && eval "$(fnm env --use-on-cd)"

command -v zoxide > /dev/null && eval "$(zoxide init zsh)"

command -v starship > /dev/null && eval "$(starship init zsh)"

command -v atuin > /dev/null && eval "$(atuin init zsh)"


echo "ğŸš€ ZSH ç¯å¢ƒå·²åŠ è½½ - dotfiles ç³»ç»Ÿ"